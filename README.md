# ActiveTopic

ActiveTopic is a gem developed for Ruby on Rails that will allow you to simply add Google Cloud Topics to your Ruby on Rails application.

## Information

* Source code [available on GitHub](https://github.com/shopmium/active_topic)

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'active_topic', '~> 0.1.0'
```

And then execute:

```console
$ bundle install
```

Or install it yourself as:

```console
$ gem install active_topic
```

## Getting Started

There are two generators provided by ActiveTopic in order to help you to setup your ActiveTopic installation.

After having add ActiveTopic to your Gemfile and ran bundle install, you need to run the following generator:

```ruby
rails generate active_topic:setup
```

This generator will create a new file (`config/initializers/active_topic.rb`).
In this file you will find:

```ruby
ActiveTopic.configure do |config|
  config.project_id = 'Your Google Cloud project id'
  config.credentials = 'Your Google Cloud credentials'
end
```

project_id will contain your [Google Cloud project id](https://cloud.google.com/resource-manager/docs/creating-managing-projects)
credentials will be the absolute path to the credentials json file that you can for your [Google service account](https://cloud.google.com/iam/docs/creating-managing-service-accounts).

## How to use?

### Generate your classes

After having filled up the `config/initializers/active_topic.rb` file, you can then run the following generator:

```ruby
rails generate active_topic:topic TopicName
```

TopicName is the name of the topic to which you want to publish messages.
As an example you could run:

```ruby
rails generate active_topic:topic MyFirstOne
```

This generator will create a new file `app/topics/my_first_one_topic.rb`. This file will contain a simple ruby class:

```ruby
class MyFirstOneTopic < ActiveTopic::Base
end
```

All the classes generated by the generator will be suffixed by `Topic` and automatically be placed under the `app/topics` directory.

The class `MyFirstOneTopic` inherits from `ActiveTopic::Base`.

There are two methods you can use for this class in order to override the configuration provided by `config/initializers/active_topic.rb` when you want to use a different project or a different service account.

To override the project_id:

```ruby
class MyFirstOneTopic < ActiveTopic::Base
    with_project_id 'different_project_id'
end
```

To override the credentials:

```ruby
class MyFirstOneTopic < ActiveTopic::Base
    with_credentials 'different_credentials'
end
```

### Use the ActiveTopic classes

The classes that inherits with ActiveTopic::Base are provided with a bunch of methods.

To check for the existence of the topic on GoogleCloud, you have the following method:

```ruby
topic_created?
```

This method will return true if the topic already exists or will return false if it does not.

To create the topic:

```ruby
create_topic!
```

The name of the created topic will be the name of the class in snake_case without the topic suffix (for instance, for a class named `MyFirstOneTopic`, the topic created will be `my_first_one`)
This method will return true if the topic is created with success.
If you try the create a topic that already exists, this method will raise an ```ActiveTopic::Exceptions:TopicAlreadyExists``` exception.


To create a new subscription:

```ruby
subscribe subscription_name
```

To publish a message on the topic:

```ruby
publish
```

To asynchronously publish a message on the topic:

```ruby
publish_async
```


## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake spec` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

### Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/shopmium/active_topic.

Please add the pre-commit to your folder and follow the rubocop linter indications and follow the .rubocop.yml configuration.

### Testing

For your tests, we recommend you to use the [Google Cloud Pub/Sub emulator](https://cloud.google.com/pubsub/docs/emulator). It will enable you to stub the calls made to the GoogleCloud Pub/Sub API.

## About Shopmium

[Shopmium](https://www.shopmium.com) has been founded in 2010 by ...

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
